
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Source: Room.js | @leancloud/play</title>
    <link type="text/css" rel="stylesheet" href="styles/font-awesome.min.css">
    <link type="text/css" rel="stylesheet" href="styles/main.css">

    
</head>
<body>
<div class="main-container">
    <input type="checkbox" id="nav-trigger" class="nav-trigger">
    <label for="nav-trigger" class="navicon-button x">
      <div class="navicon"></div>
    </label>
    <label for="nav-trigger" class="overlay"></label>
    <nav class="lnb" id="lnb">
        <div class="nav-main">
            <h1><a href="index.html" class="link">@leancloud/play</a></h1>
            <span class="version">
            
                v0.13.17
            
            </span>
        </div>
        <div class="nav-search js-search">
            <input type="text" placeholder="Search docs">
            <ul class="searched-list"></ul>
        </div>

        

        <div class="scroll">
        <div class="nav-api hidden"><h3>Global</h3><ul><li class="nav-item"><a href="global.html#CreateRoomFlag">CreateRoomFlag</a></li><li class="nav-item"><a href="global.html#debug">debug</a></li><li class="nav-item"><a href="global.html#error">error</a></li><li class="nav-item"><a href="global.html#Event">Event</a></li><li class="nav-item"><a href="global.html#LogLevel">LogLevel</a></li><li class="nav-item"><a href="global.html#PlayState">PlayState</a></li><li class="nav-item"><a href="global.html#ReceiverGroup">ReceiverGroup</a></li><li class="nav-item"><a href="global.html#Region">Region</a></li><li class="nav-item"><a href="global.html#setAdapters">setAdapters</a></li><li class="nav-item"><a href="global.html#warn">warn</a></li></ul></div><div class="nav-api hidden"><h3>Classes</h3><ul class="nav-items"><li class="nav-item">
                <header>
                    <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                    <a href="LobbyRoom.html">LobbyRoom</a>
                </header>
                <div class="nav-item-sub hidden" id="LobbyRoom_sub"><div><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item "><a href="LobbyRoom.html#customRoomProperties">customRoomProperties</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#emptyRoomTtl">emptyRoomTtl</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#expectedUserIds">expectedUserIds</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#maxPlayerCount">maxPlayerCount</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#playerCount">playerCount</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#playerTtl">playerTtl</a></a></li><li class="sub-nav-item "><a href="LobbyRoom.html#roomName">roomName</a></a></li></ul></div></div>
            </li><li class="nav-item">
                <header>
                    <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                    <a href="Play.html">Play</a>
                </header>
                <div class="nav-item-sub hidden" id="Play_sub"><div><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item "><a href="Play.html#lobbyRoomList">lobbyRoomList</a></a></li><li class="sub-nav-item "><a href="Play.html#player">player</a></a></li><li class="sub-nav-item "><a href="Play.html#room">room</a></a></li><li class="sub-nav-item "><a href="Play.html#userId">userId</a></a></li></ul></div><div><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item "><a href="Play.html#connect">connect</a></a></li><li class="sub-nav-item "><a href="Play.html#createRoom">createRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#disconnect">disconnect</a></a></li><li class="sub-nav-item "><a href="Play.html#init">init</a></a></li><li class="sub-nav-item "><a href="Play.html#joinLobby">joinLobby</a></a></li><li class="sub-nav-item "><a href="Play.html#joinOrCreateRoom">joinOrCreateRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#joinRandomRoom">joinRandomRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#joinRoom">joinRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#leaveLobby">leaveLobby</a></a></li><li class="sub-nav-item "><a href="Play.html#leaveRoom">leaveRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#reconnect">reconnect</a></a></li><li class="sub-nav-item "><a href="Play.html#reconnectAndRejoin">reconnectAndRejoin</a></a></li><li class="sub-nav-item "><a href="Play.html#rejoinRoom">rejoinRoom</a></a></li><li class="sub-nav-item "><a href="Play.html#sendEvent">sendEvent</a></a></li><li class="sub-nav-item "><a href="Play.html#setMaster">setMaster</a></a></li><li class="sub-nav-item "><a href="Play.html#setRoomOpened">setRoomOpened</a></a></li><li class="sub-nav-item "><a href="Play.html#setRoomVisible">setRoomVisible</a></a></li></ul></div><div><div class="member-type">Events</div><ul class="inner"><li class="sub-nav-item "><a href="Play.html#event:CONNECT_FAILED">CONNECT_FAILED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:CONNECTED">CONNECTED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:CUSTOM_EVENT">CUSTOM_EVENT</a></a></li><li class="sub-nav-item "><a href="Play.html#event:DISCONNECTED">DISCONNECTED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ERROR">ERROR</a></a></li><li class="sub-nav-item "><a href="Play.html#event:LOBBY_JOINED">LOBBY_JOINED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:LOBBY_LEFT">LOBBY_LEFT</a></a></li><li class="sub-nav-item "><a href="Play.html#event:LOBBY_ROOM_LIST_UPDATED">LOBBY_ROOM_LIST_UPDATED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:MASTER_SWITCHED">MASTER_SWITCHED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:PLAYER_ACTIVITY_CHANGED">PLAYER_ACTIVITY_CHANGED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:PLAYER_CUSTOM_PROPERTIES_CHANGED">PLAYER_CUSTOM_PROPERTIES_CHANGED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:PLAYER_ROOM_JOINED">PLAYER_ROOM_JOINED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:PLAYER_ROOM_LEFT">PLAYER_ROOM_LEFT</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_CREATE_FAILED">ROOM_CREATE_FAILED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_CREATED">ROOM_CREATED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_CUSTOM_PROPERTIES_CHANGED">ROOM_CUSTOM_PROPERTIES_CHANGED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_JOIN_FAILED">ROOM_JOIN_FAILED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_JOINED">ROOM_JOINED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_LEFT">ROOM_LEFT</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_OPEN_CHANGED">ROOM_OPEN_CHANGED</a></a></li><li class="sub-nav-item "><a href="Play.html#event:ROOM_VISIBLE_CHANGED">ROOM_VISIBLE_CHANGED</a></a></li></ul></div></div>
            </li><li class="nav-item">
                <header>
                    <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                    <a href="Player.html">Player</a>
                </header>
                <div class="nav-item-sub hidden" id="Player_sub"><div><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item "><a href="Player.html#actorId">actorId</a></a></li><li class="sub-nav-item "><a href="Player.html#CustomProperties">CustomProperties</a></a></li><li class="sub-nav-item "><a href="Player.html#userId">userId</a></a></li></ul></div><div><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item deprecated"><a href="Player.html#getCustomProperties">getCustomProperties</a></a></li><li class="sub-nav-item "><a href="Player.html#isActive">isActive</a></a></li><li class="sub-nav-item "><a href="Player.html#isLocal">isLocal</a></a></li><li class="sub-nav-item "><a href="Player.html#isMaster">isMaster</a></a></li><li class="sub-nav-item "><a href="Player.html#setCustomProperties">setCustomProperties</a></a></li></ul></div></div>
            </li><li class="nav-item">
                <header>
                    <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                    <a href="Room.html">Room</a>
                </header>
                <div class="nav-item-sub hidden" id="Room_sub"><div><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item "><a href="Room.html#CustomProperties">CustomProperties</a></a></li><li class="sub-nav-item "><a href="Room.html#expectedUserIds">expectedUserIds</a></a></li><li class="sub-nav-item "><a href="Room.html#master">master</a></a></li><li class="sub-nav-item "><a href="Room.html#masterId">masterId</a></a></li><li class="sub-nav-item "><a href="Room.html#maxPlayerCount">maxPlayerCount</a></a></li><li class="sub-nav-item "><a href="Room.html#name">name</a></a></li><li class="sub-nav-item "><a href="Room.html#opened">opened</a></a></li><li class="sub-nav-item "><a href="Room.html#playerList">playerList</a></a></li><li class="sub-nav-item "><a href="Room.html#visible">visible</a></a></li></ul></div><div><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item deprecated"><a href="Room.html#getCustomProperties">getCustomProperties</a></a></li><li class="sub-nav-item "><a href="Room.html#getPlayer">getPlayer</a></a></li><li class="sub-nav-item "><a href="Room.html#setCustomProperties">setCustomProperties</a></a></li></ul></div></div>
            </li></ul></div>
        </div>
    </nav>

    <div class="content">
        <ul class="breadcrumbs">
            <li><a href="index.html">Docs</a> »</li>
            <li>Source: Room.js</li>
        </ul>
        <hr>
        



    
<article>
    <pre class="prettyprint source linenums"><code>import Player from './Player';

/**
 * 房间类
 */
export default class Room {
  constructor(play) {
    this._play = play;
  }

  /* eslint no-param-reassign: ["error", { "props": false }] */
  static _newFromJSONObject(play, roomJSONObject) {
    const room = new Room(play);
    room._name = roomJSONObject.cid;
    room._opened = roomJSONObject.open;
    room._visible = roomJSONObject.visible;
    room._maxPlayerCount = roomJSONObject.maxMembers;
    room._masterActorId = roomJSONObject.masterActorId;
    room._expectedUserIds = roomJSONObject.expectMembers;
    room._players = {};
    for (let i = 0; i &lt; roomJSONObject.members.length; i += 1) {
      const playerDTO = roomJSONObject.members[i];
      const player = Player._newFromJSONObject(play, playerDTO);
      if (player.userId === play.userId) {
        play._player = player;
      }
      room._players[player.actorId] = player;
    }
    if (roomJSONObject.attr) {
      room._properties = roomJSONObject.attr;
    } else {
      room._properties = {};
    }
    return room;
  }

  /**
   * 房间名称
   * @type {string}
   * @readonly
   */
  get name() {
    return this._name;
  }

  /**
   * 房间是否开启
   * @type {boolean}
   * @readonly
   */
  get opened() {
    return this._opened;
  }

  /**
   * 房间是否可见
   * @type {boolean}
   * @readonly
   */
  get visible() {
    return this._visible;
  }

  /**
   * 房间允许的最大玩家数量
   * @type {number}
   * @readonly
   */
  get maxPlayerCount() {
    return this._maxPlayerCount;
  }

  /**
   * 获取房主
   * @readonly
   */
  get master() {
    return this.getPlayer(this.masterId);
  }

  /**
   * 房间主机玩家 ID
   * @type {number}
   * @readonly
   */
  get masterId() {
    return this._masterActorId;
  }

  /**
   * 邀请的好友 ID 列表
   * @type {Array.&lt;string>}
   * @readonly
   */
  get expectedUserIds() {
    return this._expectedUserIds;
  }

  /**
   * 根据 actorId 获取 Player 对象
   * @param {number} actorId 玩家在房间中的 Id
   * @return {Player}
   */
  getPlayer(actorId) {
    if (!(typeof actorId === 'number')) {
      throw new TypeError(`${actorId} is not a number`);
    }
    const player = this._players[actorId];
    if (player === null) {
      throw new TypeError(`player with id:${actorId} not found`);
    }
    return player;
  }

  /**
   * 获取房间内的玩家列表
   * @return {Array.&lt;Player>}
   * @readonly
   */
  get playerList() {
    return Object.values(this._players);
  }

  /**
   * 设置房间的自定义属性
   * @param {Object} properties 自定义属性
   * @param {Object} [opts] 设置选项
   * @param {Object} [opts.expectedValues] 期望属性，用于 CAS 检测
   */
  setCustomProperties(properties, { expectedValues = null } = {}) {
    this._play._setRoomCustomProperties(properties, expectedValues);
  }

  /**
   * @deprecated
   * 获取自定义属性
   * @return {Object}
   */
  getCustomProperties() {
    return this._properties;
  }

  /**
   * 获取自定义属性
   * @return {Object}
   */
  get CustomProperties() {
    return this._properties;
  }

  _addPlayer(newPlayer) {
    if (!(newPlayer instanceof Player)) {
      throw new TypeError(`${newPlayer} is not a Player`);
    }
    this._players[newPlayer.actorId] = newPlayer;
  }

  _removePlayer(actorId) {
    delete this._players[actorId];
  }

  _mergeProperties(changedProperties) {
    this._properties = Object.assign(this._properties, changedProperties);
  }
}
</code></pre>
</article>





        <hr>
        <footer>
            <strong></strong><br/>
            Documented with <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
        </footer>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script>

window.isApi = true
window.isManual = false
window.doc = {
    name: '',
    longname: '',
}

if (!doc.name) isApi = false

</script>
<script src="js/rtd.js"></script>
</body>
</html>
